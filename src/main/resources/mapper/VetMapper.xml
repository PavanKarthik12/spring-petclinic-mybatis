<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="org.springframework.samples.petclinic.mapper.VetMapper">

	<insert id="save" useGeneratedKeys="true" keyProperty="id"
		parameterType="org.springframework.samples.petclinic.model.Vet">
		INSERT INTO vets
			(id,
			first_name,
			last_name)
		VALUES(
			#{id},
			#{firstName},
			#{lastName}
		)
		ON DUPLICATE KEY UPDATE
			first_name = #{firstName},
			last_name = #{lastName};
		<foreach collection="specialties" item="item" index="index" separator=" ">
			INSERT INTO specialties(id,name) VALUES(#{item.id}, #{item.name})
				ON DUPLICATE KEY UPDATE name = #{item.name};
			INSERT IGNORE INTO vet_specialties(vet_id, specialty_id) VALUES(#{id}, #{item.id});
		</foreach>
	</insert>
</mapper>